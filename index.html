<!DOCTYPE html>
<html>

<head>
<title>Minesweeper</title>

<meta charset="utf-8">
<link href="mine.css" media="screen" rel="stylesheet" type="text/css" />
<link href="win98.css" media="screen" rel="stylesheet" type="text/css" />
<link href="mine-win98.css" media="screen" rel="stylesheet" type="text/css" />

</head>

<body>

<div class="windows windows-98">

<div class="window has-menu mine-window">
    <div class="title-bar">
        <div class="title-icon"></div>
        <div class="title">Minesweeper</div>
        <div class="title-button-group">
            <div class="title-button minimize"></div>
            <div class="title-button maximize disabled"></div>
            <div class="title-button close"></div>
        </div>
    </div>
    <ul class="menu-bar">
    <li onclick="minefield.init_board(30, 16, 99)">Hard</li>
    <li onclick="minefield.init_board(30, 16, 120, 2)">Harder</li>
    <li><a href="https://github.com/egraether/mine3D">Hardest</a></li>
    <li><a href="https://github.com/klutzy/mine.js">About...</a></li>
    </ul>

    <div class="window-content">
    <div class="mine-head-area">
        <div class="mine-counter">
            <div class="digit digit-0"></div>
            <div class="digit digit-0"></div>
            <div class="digit digit-0"></div>
        </div>
        <div class="mine-reset-button" onclick="minefield.reset_board()">
            <div class="mine-reset-button-inner"></div>
        </div>
        <div class="mine-timer">
            <div class="digit digit-0"></div>
            <div class="digit digit-0"></div>
            <div class="digit digit-0"></div>
        </div>
    </div>
    <div id="mine-area" class="mine-area">
    </div>
    </div>
</div>

</div>


<script src="vendor/jquery.min.js"></script>
<script src="vendor/jquery-ui.min.js"></script>
<script src="jquery.mswin.js"></script>
<script src="jquery.mswin.listview.js"></script>
<script src="jquery.mswin.menu.js"></script>
<script src="mine.js"></script>

<script>
$('.window').window();
$('.listview').listview();
$('.desktop-listview').listview();
$('.menu-bar').menubar();
$('.taskbar ul.start').menubar({
    position_toplevel: {
        my: "left bottom",
        at: "left top",
    },
});

var update_counter = null;
var update_timer = null;

var timer_val = 0;
var timer_id = null;

var mine_area = document.getElementById("mine-area");
var minefield = new window.Minefield(mine_area, function(status) {
    var smile = $(".mine-reset-button .mine-reset-button-inner");
    var bg_pos = "0 0";
    if (status === -1) {
        bg_pos = "-17px 0";
    }
    if (status === -2) {
        bg_pos = "-51px 0";
    }
    smile.css({
        "background-position": bg_pos,
    });

    if (status === 0) {
        timer_id = window.setInterval(update_timer, 1 * 1000);
    }
    if (status < 0 || status === 1) {
        window.clearInterval(timer_id);
        if (status === 1) {
            var num_counter = minefield.num_mines - minefield.num_flags;
            var counter_obj = $(".mine-counter");
            update_counter(num_counter, counter_obj);

            timer_val = 0;
            timer_id = null;
            var timer_obj = $(".mine-timer");
            update_counter(0, timer_obj);
        }
    }
});

update_timer = function() {
    timer_val += 1;
    var timer_obj = $(".mine-timer");
    update_counter(timer_val, timer_obj);
}

update_counter = function(val, counter) {
    if (val > 999) {
        val = 999;
    }
    if (val < 0) {
        val = 0;
    }
    var digits = [
        Math.floor(val / 100),
        Math.floor(val / 10) % 10,
        val % 10
    ];
    for (var i = 0; i < 3; i++) {
        var d = digits[i];
        var child = $(counter.children()[i]);
        child.removeClass();
        child.addClass("digit digit-" + d);
    }
};
minefield.on_rclick_func = function(x, y) {
    var num_counter = minefield.num_mines - minefield.num_flags;
    var counter_obj = $(".mine-counter");
    update_counter(num_counter, counter_obj);
};

minefield.init_board(30, 16, 120, 2);
</script>

</body>

</html>

